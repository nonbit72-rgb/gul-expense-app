<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0f172a">
<title>GUL Advanced Expense App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="manifest" href="manifest.json">
    <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
    </script>
<style>
body{
    background:#0f172a;
    color:#e2e8f0;
    font-family:Arial;
    padding:15px;
}
h1{text-align:center;}
.card{
    background:#1e293b;
    padding:15px;
    margin:10px 0;
    border-radius:10px;
}
input,select,button{
    padding:10px;
    margin:5px 0;
    border-radius:5px;
    border:none;
    width:100%;
}
button{
    background:#3b82f6;
    color:white;
}
button:hover{ background:#2563eb; }
canvas{
    background:#111827;
    border-radius:10px;
}
.stat{
    font-size:16px;
    margin:5px 0;
}
</style>
</head>
<body>

<h1>GUL Expense Manager</h1>

<div class="card">
<div class="stat" id="time"></div>
<div class="stat" id="total"></div>
<div class="stat" id="avgDay"></div>
<div class="stat" id="avgMonth"></div>
</div>
<div class="card">
<h3>Monthly Budget</h3>

<input type="number" id="monthlyBudget" 
placeholder="Set Monthly Budget"
style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;">

<button onclick="setBudget()">Set Budget</button>

<div id="budgetInfo" style="margin-top:10px;"></div>
</div>
<div class="card">
<canvas id="lineChart"></canvas>
</div>

<div class="card">
<canvas id="pieChart"></canvas>
</div>

<div class="card">
<select id="category">
<option>Food</option>
<option>Travel</option>
<option>Shopping</option>
<option>College Expense</option>
<option>Other</option>
</select>

<input type="number" id="amount" placeholder="Enter Amount">

<button onclick="addExpense()">Add Expense</button>
<button onclick="exportCSV()">Export CSV</button>
</div>
<div class="card">

<select onchange="sortExpenses(this.value)"
style="width:100%;padding:8px;margin-bottom:10px;border-radius:8px;">
<option value="latest">Latest</option>
<option value="oldest">Oldest</option>
<option value="high">Highest</option>
<option value="low">Lowest</option>
</select>

<h3>Expense List</h3>

<input type="text" id="searchInput" 
placeholder="Search expenses..." 
onkeyup="renderExpenseList()" 
style="width:100%;padding:8px;margin-bottom:10px;border-radius:8px;">

<div id="expenseList"></div>

</div>
    <input type="number" id="monthlyBudget" placeholder="Set Monthly Budget">
<button onclick="setBudget()">Set Budget</button>
<div id="budgetInfo"></div>
<script>
//-----budget-------
    let monthlyBudget = localStorage.getItem("budget") || 0;

function setBudget(){
    monthlyBudget = parseFloat(document.getElementById("monthlyBudget").value);
    localStorage.setItem("budget",monthlyBudget);
    updateBudget();
}

function updateBudget(){
    let total = expenses.reduce((sum,e)=>sum+e.amount,0);
    let remaining = monthlyBudget - total;

    document.getElementById("budgetInfo").innerHTML = 
    `Budget: â‚¹${monthlyBudget} <br>
     Remaining: â‚¹${remaining}`;

    if(total > monthlyBudget){
        document.getElementById("budgetInfo").style.color="red";
    }
}
// -------- DATA --------
let expenses = JSON.parse(localStorage.getItem("gulData")) || [];

// -------- ADD EXPENSE --------
function addExpense(){

    let cat = document.getElementById("category").value;
    let amt = parseFloat(document.getElementById("amount").value);
    if(!amt) return;

    let now = new Date(); // REAL CURRENT TIME

    expenses.push({
        category:cat,
        amount:amt,
        date:now.toISOString()
    });

    localStorage.setItem("gulData",JSON.stringify(expenses));
    document.getElementById("amount").value="";
    updateAll();
}

// -------- STATS --------
function updateStats(){

    let total = 0;
    expenses.forEach(e=> total+=e.amount);

    let now = new Date();

    // First expense date
    let firstDate = expenses.length > 0 
        ? new Date(expenses[0].date)
        : now;

    let diffTime = now - firstDate;

    let days = Math.max(1, Math.floor(diffTime / (1000*60*60*24)) + 1);
    let months = Math.max(1, Math.floor(days/30));
    let minutes = Math.max(1, Math.floor(diffTime / (1000*60)));

    let avgPerDay = total/days;
    let avgPerMonth = total/months;
    let avgPerMinute = total/minutes;

    document.getElementById("total").innerText =
        "Total Spending: â‚¹"+total.toFixed(2);

    document.getElementById("avgDay").innerText =
        "Average Per Day: â‚¹"+avgPerDay.toFixed(2);

    document.getElementById("avgMonth").innerText =
        "Average Per Month: â‚¹"+avgPerMonth.toFixed(2);

    document.getElementById("time").innerText =
        "Current Time (IST): " +
        now.toLocaleString("en-IN", {
            timeZone: "Asia/Kolkata",
            hour12:false
        });

    // ðŸ†• Add this line display
    if(!document.getElementById("avgMinute")){
        let div = document.createElement("div");
        div.className="stat";
        div.id="avgMinute";
        document.querySelector(".card").appendChild(div);
    }

    document.getElementById("avgMinute").innerText =
        "Average Per Minute: â‚¹"+avgPerMinute.toFixed(4);
}

// -------- DAILY DATA --------
function getDailyData(){
    let map={};
    expenses.forEach(e=>{
        let d = new Date(e.date).toLocaleDateString("en-CA");
        if(!map[d]) map[d]=0;
        map[d]+=e.amount;
    });
    return map;
}

// -------- CATEGORY DATA --------
function getCategoryData(){
    let map={};
    expenses.forEach(e=>{
        if(!map[e.category]) map[e.category]=0;
        map[e.category]+=e.amount;
    });
    return map;
}

// -------- CHARTS --------
let lineChart = new Chart(document.getElementById("lineChart"),{
type:'line',
data:{labels:[],datasets:[{
    label:'Daily Spending',
    data:[],
    borderColor:'#3b82f6',
    fill:false
}]},
options:{animation:false,responsive:true}
});

let pieChart = new Chart(document.getElementById("pieChart"),{
type:'pie',
data:{labels:[],datasets:[{data:[]}]},
options:{animation:false,responsive:true}
});

function updateCharts(){
    let daily = getDailyData();
    lineChart.data.labels = Object.keys(daily);
    lineChart.data.datasets[0].data = Object.values(daily);
    lineChart.update();

    let cat = getCategoryData();
    pieChart.data.labels = Object.keys(cat);
    pieChart.data.datasets[0].data = Object.values(cat);
    pieChart.update();
}

// -------- EXPORT CSV --------
function exportCSV(){
    let csv="Category,Amount,Date\n";
    expenses.forEach(e=>{
        csv+=`${e.category},${e.amount},${e.date}\n`;
    });

    let blob=new Blob([csv],{type:"text/csv"});
    let link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="expenses.csv";
    link.click();
}
    function renderExpenseList(){

    let container = document.getElementById("expenseList");
    container.innerHTML = "";

    let search = document.getElementById("searchInput")?.value.toLowerCase() || "";

    expenses.forEach((e,index)=>{

        if(
            e.category.toLowerCase().includes(search) ||
            e.amount.toString().includes(search)
        ){

            let div = document.createElement("div");
            div.style.background="#0f172a";
            div.style.padding="8px";
            div.style.margin="5px 0";
            div.style.borderRadius="8px";

            let date = new Date(e.date).toLocaleString("en-IN", {
                timeZone:"Asia/Kolkata",
                hour12:false
            });

            div.innerHTML = `
                <strong>${e.category}</strong> - â‚¹${e.amount.toFixed(4)}<br>
                <small>${date}</small><br>
                <button onclick="editExpense(${index})">Edit</button>
                <button onclick="removeExpense(${index})" style="background:#ef4444">Remove</button>
            `;

            container.appendChild(div);
        }
    });
}

        div.innerHTML = `
            <strong>${e.category}</strong> - â‚¹${e.amount.toFixed(4)}<br>
            <small>${date}</small><br>
            <button onclick="editExpense(${index})">Edit</button>
<button onclick="removeExpense(${index})" style="background:#ef4444">Remove</button>
        `;

        container.appendChild(div);
    });
}
    //----edit------------
    function editExpense(index){
    let newAmount = prompt("Enter new amount:", expenses[index].amount);
    if(newAmount !== null){
        expenses[index].amount = parseFloat(newAmount);
        localStorage.setItem("gulData",JSON.stringify(expenses));
        updateAll();
    }
    }
    //-------sort--------
    function sortExpenses(type){
    if(type=="latest") expenses.sort((a,b)=> new Date(b.date)-new Date(a.date));
    if(type=="oldest") expenses.sort((a,b)=> new Date(a.date)-new Date(b.date));
    if(type=="high") expenses.sort((a,b)=> b.amount-a.amount);
    if(type=="low") expenses.sort((a,b)=> a.amount-b.amount);
    updateAll();
    }
//-------remove expansion ---------
function removeExpense(index){
    expenses.splice(index,1);
    localStorage.setItem("gulData",JSON.stringify(expenses));
    updateAll();
}
//-----    edit exp-------
    function editExpense(index){
    let newAmount = prompt("Enter new amount:", expenses[index].amount);
    if(newAmount !== null){
        expenses[index].amount = parseFloat(newAmount);
        localStorage.setItem("gulData",JSON.stringify(expenses));
        updateAll();
    }
    }
// -------- UPDATE ALL --------
function updateAll(){
    updateStats();
    updateCharts();
    renderExpenseList();
    updateBudget();
}
// -------- REAL TIME CLOCK --------
setInterval(updateStats,1000);

updateAll();

</script>
</body>
</html>
