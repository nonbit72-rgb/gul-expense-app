<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0f172a">
<title>GUL Advanced Expense App</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="manifest" href="manifest.json">

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>

<style>
body{
    background:#0f172a;
    color:#e2e8f0;
    font-family:Arial;
    padding:15px;
    margin:0;
}
h1{text-align:center;}

.card{
    background:#1e293b;
    padding:15px;
    margin:10px 0;
    border-radius:10px;
}

input,select,button{
    padding:10px;
    margin:5px 0;
    border-radius:5px;
    border:none;
    width:100%;
}

button{
    background:#3b82f6;
    color:white;
}

button:hover{ background:#2563eb; }

canvas{
    background:#111827;
    border-radius:10px;
}

.stat{
    font-size:16px;
    margin:5px 0;
}

.section{
  margin-bottom:80px;
}

.bottomNav{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#1e293b;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
}

.bottomNav button{
  background:none;
  color:#e2e8f0;
  border:none;
  font-size:14px;
}

.bottomNav button:hover{
  color:#3b82f6;
}
</style>
</head>

<body>

<h1>GUL Expense Manager</h1>

<!-- -------- HOME SECTION -------- -->
<div id="homeSection" class="section">
  <div class="card">
    <div class="stat" id="time"></div>
    <div class="stat" id="total"></div>
    <div class="stat" id="avgMonth"></div>
    <div class="stat" id="avgDay"></div>
    <div class="stat" id="avgHour"></div>
    <div class="stat" id="avgMinute"></div>
  </div>
</div>

<!-- -------- BUDGET SECTION -------- -->
<div id="budgetSection" class="section" style="display:none;">
  <div class="card">
    <h3>Monthly Budget</h3>
    <input type="number" id="monthlyBudget" placeholder="Set Monthly Budget">
    <button onclick="setBudget()">Set Budget</button>
    <div id="budgetInfo"></div>
  </div>

  <div class="card"><canvas id="lineChart"></canvas></div>
  <div class="card"><canvas id="pieChart"></canvas></div>
</div>

<!-- -------- ADD SECTION -------- -->
<div id="addSection" class="section" style="display:none;">
  <div class="card">
    <select id="category">
      <option>Food</option>
      <option>Travel</option>
      <option>Shopping</option>
      <option>College Expense</option>
      <option>Other</option>
    </select>
    <input type="number" id="amount" placeholder="Enter Amount">
    <button onclick="addExpense()">Add Expense</button>
  </div>
</div>

<!-- -------- LIST SECTION -------- -->
<div id="listSection" class="section" style="display:none;">
  <div class="card">
    <select onchange="sortExpenses(this.value)">
      <option value="latest">Latest</option>
      <option value="oldest">Oldest</option>
      <option value="high">Highest</option>
      <option value="low">Lowest</option>
    </select>
    <input type="text" id="searchInput" placeholder="Search expenses..." onkeyup="renderExpenseList()">
    <div id="expenseList"></div>
  </div>
</div>

<!-- -------- NAVIGATION -------- -->
<div class="bottomNav">
  <button onclick="showSection('homeSection')">Home</button>
  <button onclick="showSection('budgetSection')">Budget</button>
  <button onclick="showSection('addSection')">Add</button>
  <button onclick="showSection('listSection')">Expenses</button>
</div>

<script>

/* =========================================================
   =============== GLOBAL VARIABLES ========================
========================================================= */

let expenses = JSON.parse(localStorage.getItem("gulData")) || [];
let monthlyBudget = localStorage.getItem("budget") || 0;

let previousTotal = 0;
let stockChart;
let stockValues = [];


/* =========================================================
   =============== NAVIGATION SECTION ======================
========================================================= */

function showSection(sectionId){
  document.querySelectorAll(".section").forEach(sec => sec.style.display="none");
  document.getElementById(sectionId).style.display="block";
}


/* =========================================================
   =============== BUDGET SECTION ==========================
========================================================= */

function setBudget(){
  monthlyBudget = parseFloat(document.getElementById("monthlyBudget").value) || 0;
  localStorage.setItem("budget",monthlyBudget);
  updateBudget();
}

function updateBudget(){
  let total = getTotal();
  let remaining = monthlyBudget - total;

  let info = document.getElementById("budgetInfo");
  info.innerHTML = `
    Budget: ₹${monthlyBudget}<br>
    Remaining: ₹${remaining}
  `;

  info.style.color = total > monthlyBudget ? "red" : "#22c55e";
}


/* =========================================================
   =============== EXPENSE SECTION =========================
========================================================= */

function addExpense(){
  let cat = document.getElementById("category").value;
  let amt = parseFloat(document.getElementById("amount").value);
  if(!amt) return;

  expenses.push({
    category:cat,
    amount:amt,
    date:new Date().toISOString()
  });

  localStorage.setItem("gulData",JSON.stringify(expenses));
  document.getElementById("amount").value="";
  updateAll();
}

function getTotal(){
  return expenses.reduce((sum,e)=>sum+e.amount,0);
}


/* =========================================================
   =============== MINI STOCK CHART INIT ===================
========================================================= */

function initMiniChart(){

  const canvas = document.createElement("canvas");
  canvas.id = "miniStockChart";
  canvas.height = 80;

  document.querySelector("#homeSection .card").appendChild(canvas);

  stockChart = new Chart(canvas, {
    type: "line",
    data: {
      labels: [],
      datasets: [{
        data: [],
        borderColor: "#22c55e",
        borderWidth: 2,
        tension: 0.4,
        fill: false,
        pointRadius: 0
      }]
    },
    options: {
      responsive:true,
      plugins:{ legend:{display:false}},
      scales:{
        x:{display:false},
        y:{display:false}
      }
    }
  });
}


/* =========================================================
   =============== HOME LIVE UPDATE ========================
========================================================= */

function updateHomeLive(){

  let total = getTotal();
  let now = new Date();

  /* ---- STOCK CHANGE INDICATOR ---- */

  let change = total - previousTotal;
  let arrow = change >= 0 ? "▲" : "▼";
  let color = change >= 0 ? "#22c55e" : "#ef4444";

  document.getElementById("total").innerHTML =
    `Total Spending: ₹${total.toFixed(2)}
     <span style="color:${color};font-weight:bold;">
     ${arrow} ${Math.abs(change).toFixed(2)}
     </span>`;

  document.getElementById("time").innerHTML =
    "Market Time (IST): " +
    now.toLocaleTimeString("en-IN",{hour12:false});


  /* ---- AVERAGE CALCULATIONS ---- */

  let months = 1;
  let days = 30;
  let hours = days * 24;
  let minutes = hours * 60;

  document.getElementById("avgMonth").innerHTML =
    "Average / Month: ₹" + (total/months).toFixed(2);

  document.getElementById("avgDay").innerHTML =
    "Average / Day: ₹" + (total/days).toFixed(2);

  document.getElementById("avgHour").innerHTML =
    "Average / Hour: ₹" + (total/hours).toFixed(4);

  document.getElementById("avgMinute").innerHTML =
    "Average / Minute: ₹" + (total/minutes).toFixed(6);


  /* ---- MINI STOCK CHART UPDATE ---- */

  updateMiniChart(total);

  previousTotal = total;
}


/* =========================================================
   =============== MINI STOCK CHART UPDATE =================
========================================================= */

function updateMiniChart(value){

  if(!stockChart) return;

  let timeLabel = new Date().toLocaleTimeString();

  stockValues.push(value);

  stockChart.data.labels.push(timeLabel);
  stockChart.data.datasets[0].data.push(value);

  if(stockValues.length > 20){
    stockValues.shift();
    stockChart.data.labels.shift();
    stockChart.data.datasets[0].data.shift();
  }

  stockChart.update();
}


/* =========================================================
   =============== EXPENSE LIST ============================
========================================================= */

function renderExpenseList(){
  let container=document.getElementById("expenseList");
  container.innerHTML="";

  let search = document.getElementById("searchInput").value.toLowerCase();

  expenses.forEach(e=>{
    if(!e.category.toLowerCase().includes(search)) return;

    let div=document.createElement("div");
    div.style.background="#0f172a";
    div.style.padding="8px";
    div.style.margin="5px 0";
    div.style.borderRadius="8px";

    div.innerHTML=`
      <strong>${e.category}</strong> 
      - ₹${e.amount.toFixed(2)}
    `;

    container.appendChild(div);
  });
}


/* =========================================================
   =============== SORT SECTION ============================
========================================================= */

function sortExpenses(type){
  if(type=="latest") expenses.sort((a,b)=>new Date(b.date)-new Date(a.date));
  if(type=="oldest") expenses.sort((a,b)=>new Date(a.date)-new Date(b.date));
  if(type=="high") expenses.sort((a,b)=>b.amount-a.amount);
  if(type=="low") expenses.sort((a,b)=>a.amount-b.amount);

  updateAll();
}


/* =========================================================
   =============== MASTER UPDATE ===========================
========================================================= */

function updateAll(){
  renderExpenseList();
  updateBudget();
  updateHomeLive();
}


/* =========================================================
   =============== LIVE UPDATE EVERY SECOND =================
========================================================= */

setInterval(function(){
  if(document.getElementById("homeSection").style.display !== "none"){
    updateHomeLive();
  }
},1000);


/* =========================================================
   =============== INITIAL LOAD ============================
========================================================= */

initMiniChart();
updateAll();

</script>
</body>
</html>
